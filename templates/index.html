{% extends 'base.html' %}
{% block filters %}
<form method="get" action="/" class="filters">
  <input type="text" name="q" placeholder="Search news..." value="{{ q or '' }}">
  <label>Region:
    <select name="region">
      <option value="">All</option>
      {% for r in regions %}
      <option value="{{ r }}" {% if region==r %}selected{% endif %}>{{ r.replace('-', ' ').title() }}</option>
      {% endfor %}
    </select>
  </label>
  <label>Domain:
    <select name="domain">
      <option value="">All</option>
      {% for d in domains %}
      <option value="{{ d }}" {% if domain==d %}selected{% endif %}>{{ d.title() }}</option>
      {% endfor %}
    </select>
  </label>
  <label>Source:
    <select name="source">
      <option value="">All</option>
      {% for s in sources %}
      <option value="{{ s }}" {% if source==s.lower() %}selected{% endif %}>{{ s }}</option>
      {% endfor %}
    </select>
  </label>
  <label>View:
    <select name="view">
      <option value="grid" {% if view=='grid' %}selected{% endif %}>Grid</option>
      <option value="list" {% if view=='list' %}selected{% endif %}>Timeline</option>
    </select>
  </label>
  <button class="btn-primary" type="submit">Apply</button>
  <a class="btn" href="/">Clear</a>
</form>
{% endblock %}

{% block content %}
<div class="main">
  {% if view == 'list' %}
    <ul class="timeline">
      {% for a in articles %}
      <li class="card list">
        <div class="meta">
          {% if a.published %}<span>{{ a.published|datetimeformat }}</span>{% endif %}
          <span>• {{ a.source }}</span>
        </div>
        <a class="title" href="{{ a.link }}" target="_blank">{{ a.title }}</a>
        {% if a.image %}
          <img class="thumb" src="/thumb?u={{ a.image|ue }}&w=300&h=200" alt="">
        {% endif %}
        <p class="summary">{{ a.summary|safe }}</p>
        <a class="more" href="{{ a.link }}" target="_blank">Read More →</a>
      </li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="cards-grid">
      {% for a in articles %}
      <article class="card">
        {% if a.image %}
          <figure class="card-cover">
            <img src="/thumb?u={{ a.image|ue }}&w=500&h=500" alt="{{ a.title }}">
          </figure>
        {% endif %}
        <a class="title" href="{{ a.link }}" target="_blank">{{ a.title }}</a>
        <p class="summary">{{ a.summary|safe }}</p>
        <div class="meta">
          <span>{{ a.source }}</span>
          {% if a.published %}<span>• {{ a.published|datetimeformat }}</span>{% endif %}
        </div>
        <a class="more" href="{{ a.link }}" target="_blank">Read More →</a>
      </article>
      {% endfor %}
    </div>
  {% endif %}
</div>
{% endblock %}
